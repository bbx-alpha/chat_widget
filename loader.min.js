window.onload=function(){function e(){try{const e=localStorage.getItem("chatName"),t=localStorage.getItem("chatEmail"),a=localStorage.getItem("chatPhone");d.style.display=e||t||a?"block":"none",e&&(document.getElementById("name").value=e),t&&(document.getElementById("email").value=t),a&&(document.getElementById("phone").value=a)}catch(e){console.error("Error loading data from local storage: ",e)}}function t(){try{const e=document.getElementById("name").value,t=document.getElementById("email").value,a=document.getElementById("phone").value;localStorage.setItem("chatName",e),localStorage.setItem("chatEmail",t),localStorage.setItem("chatPhone",a)}catch(e){console.error("Error saving data to local storage: ",e)}}function a(e,t,a,n){const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=/^\+?[0-9\s\-\(\)]{7,}$/;return e.trim()?o.test(t)?a&&!l.test(a)?(c.textContent="Please enter a valid phone number.",c.className="error",c.style.display="block",!1):n.trim()?(c.style.display="none",!0):(c.textContent="Please enter your message.",c.className="error",c.style.display="block",!1):(c.textContent="Please enter a valid email address.",c.className="error",c.style.display="block",!1):(c.textContent="Please enter your name.",c.className="error",c.style.display="block",!1)}function n(){l.classList.remove("open"),setTimeout(()=>{l.style.display="none"},300)}var o=document.getElementById("chat-form"),l=document.getElementById("custom-chat-widget"),s=document.getElementById("chat-toggle-button"),r=document.getElementById("chat-close-button"),c=document.getElementById("chat-response-message"),d=document.getElementById("clear-user-data");d.addEventListener("click",function(){try{localStorage.removeItem("chatName"),localStorage.removeItem("chatEmail"),localStorage.removeItem("chatPhone"),c.textContent="Your data has been cleared.",c.className="success",c.style.display="block",o.reset()}catch(e){console.error("Error clearing data from local storage: ",e),c.textContent="An error occurred while clearing your data.",c.className="error",c.style.display="block"}}),s.addEventListener("click",function(){"none"!==l.style.display&&l.classList.contains("open")?n():(l.style.display="flex",setTimeout(function(){l.classList.add("open")},10),e()),c.style.display="none"}),r.addEventListener("click",n),document.addEventListener("click",function(e){l.contains(e.target)||s.contains(e.target)||l.classList.contains("open")&&n()});var m=!1;o.addEventListener("submit",function(e){if(e.preventDefault(),!m){var n=document.getElementById("name").value,l=document.getElementById("email").value,s=document.getElementById("phone").value,r=document.getElementById("message").value;if(a(n,l,s,r)){m=!0;var d=document.getElementById("submit-button");d.disabled=!0,d.textContent="Sending...";var i="https://broad-hall-5e51.krathaur.workers.dev/";fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:l,phone:s,message:r})}).then(function(e){e.ok?(c.textContent="Thank you! Your message has been sent.",c.className="success",t(),o.reset()):(c.textContent="There was an error submitting your message. Please try again.",c.className="error")}).catch(function(e){console.error("Error:",e),c.textContent="An error occurred. Please try again.",c.className="error"}).finally(function(){d.disabled=!1,d.textContent="Send Message",c.style.display="block",m=!1})}}}),document.querySelectorAll(".quick-reply").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),document.getElementById("message").value=this.dataset.message,this.style.display="none"})}),s.addEventListener("click",function(){"flex"===l.style.display&&document.querySelectorAll(".quick-reply").forEach(e=>{e.style.display="inline-block"})})};